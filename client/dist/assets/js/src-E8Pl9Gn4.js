import{j as e,r as y,a as se}from"./react-CeAEre3e.js";import{c as te}from"./react-dom-DQPHON6Y.js";import{u as A,a as K,b as T,Q as ne,c as oe}from"./react-query-CtT69xRw.js";import{L as k,c as ae,R as ie}from"./react-router-dom-D8Mqvj2l.js";import{s as le,M as F,A as Q,F as p,I as v,T as w,a as V,B as C,D as ce,C as J,b as de,c as ue,d as O,e as me}from"./antd-BzFJiB8B.js";import{u as q,C as f}from"./react-hook-form-DC-kkWP6.js";import{o as R}from"./@hookform-zccJT-fy.js";import{c as L,a as b,b as N}from"./yup-B_eCBuOw.js";import{a as he}from"./axios-dxcvQi4N.js";import{M as W,F as G,B as pe}from"./react-icons-BVcdleRH.js";import{A as xe,M as je}from"./@vis.gl-D6HFOrRq.js";import{c as Y,O as fe,f as z}from"./react-router-D0Qf5fn4.js";import{t as ge}from"./@ant-design-B09QxqsT.js";import{l as ye}from"./workbox-window-DYhqFQ2O.js";var _e={};const U=_e.REACT_APP_TOKEN_KEY||"",be=r=>{sessionStorage.setItem(U,JSON.stringify({id:r}))},X=()=>{const r=sessionStorage.getItem(U);if(!r)return null;const{id:s}=JSON.parse(r);return s},ve=()=>{sessionStorage.removeItem(U),sessionStorage.clear()},we=(r,s)=>{sessionStorage.setItem("username",r),sessionStorage.setItem("role",s)},Ce=()=>sessionStorage.getItem("role");var Ae={};const Se=Ae.REACT_APP_BACKEND_URL_API,D=he.create({baseURL:Se,headers:{Authorization:`Bearer ${X()}`}}),Ne=r=>{D.defaults.headers.common.Authorization=`Bearer ${r}`},P=async(r,s,t={})=>(t!=null&&t.headers||(t.headers={}),t.headers["Content-Type"]="application/json",D.post(r,JSON.stringify(s),t)),Z=async(r,s={})=>D.get(r,s),ee=async(r,s={})=>(s!=null&&s.headers||(s.headers={}),s.headers["Content-Type"]="application/json",D.delete(r,s)),Fe=async(r,s,t={})=>(t!=null&&t.headers||(t.headers={}),t.headers["Content-Type"]="application/json",D.patch(r,JSON.stringify(s),t)),qe=r=>{const{data:s,isSuccess:t,isLoading:n}=K({queryKey:["get-apartments"],queryFn:()=>Z("apartment/list",{params:r})});return{data:s,isSuccess:t,isLoading:n}},Ie=({onSuccess:r,onError:s})=>{const{mutate:t,isError:n,isLoading:a,isSuccess:o,data:l}=A({mutationFn:i=>P("apartment/new",i),onSuccess:r,onError:s});return{mutate:t,isError:n,isLoading:a,isSuccess:o,data:l}},ke=({onSuccess:r,onError:s})=>{const{mutate:t,isError:n,isLoading:a,isSuccess:o,data:l}=A({mutationFn:i=>Fe(`apartment/${i.id}`,i),onSuccess:r,onError:s});return{mutate:t,isError:n,isLoading:a,isSuccess:o,data:l}},Ee=({onSuccess:r,onError:s})=>{const{mutate:t,isError:n,isLoading:a,isSuccess:o,data:l}=A({mutationFn:i=>ee(`apartment/${i}`),onSuccess:r,onError:s});return{mutate:t,isError:n,isLoading:a,isSuccess:o,data:l}},S=()=>{const[r,s]=le.useNotification();return{openNotification:(n,a)=>{r.open({type:a,message:"Notification",description:n,placement:"topRight"})},contextHolder:s}};function Te({onCancel:r,isModalOpen:s,title:t,currentRowId:n}){const a=T(),{openNotification:o,contextHolder:l}=S(),{mutate:i}=Ee({onSuccess:()=>{o("Deleted Apartment successfully","success"),r(),a.invalidateQueries("get-apartments")},onError:()=>{o("Failed to deleted the Apartment!","error")}}),h=()=>{i(n)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{title:t,style:{height:300},open:s,onOk:h,onCancel:r,children:e.jsx(Q,{type:"error",description:"Are you sure to delete the Apartment?"})}),l]})}const Re=L({name:b().required(),description:b(),price_per_month:N().required(),floor_area_size:N().required(),number_of_rooms:N().required()});function Le({onCancel:r,isModalOpen:s,id:t}){const{control:n,handleSubmit:a,formState:{errors:o}}=q({defaultValues:{name:"",description:"",price_per_month:0,floor_area_size:0,number_of_rooms:0},resolver:R(Re)}),{openNotification:l,contextHolder:i}=S(),[h,u]=y.useState(!1),x=T(),{mutate:m}=ke({onSuccess(c){r(),x.invalidateQueries(["get-apartments"]),l("The apartment has been updated successfully","success")},onError:()=>{l("Failed to update the apartment","error")}}),d=c=>({name:c.name,description:c.description,price_per_month:parseFloat(c.price_per_month),floor_area_size:parseFloat(c.floor_area_size),number_of_rooms:parseInt(c.number_of_rooms),coordinates:JSON.stringify([130.342,32.3213])}),j=c=>{const g=d(c);Object.keys(g).length!==0&&m(g)};return e.jsxs(e.Fragment,{children:[e.jsxs(F,{title:"Edit the apartment details",style:{height:300},open:s,onOk:a(j),onCancel:r,children:[e.jsxs(p,{layout:"vertical",children:[e.jsx(f,{control:n,rules:{required:!0},render:({field:{onChange:c,onBlur:g,value:_}})=>e.jsxs(p.Item,{label:"Name",children:[e.jsx(v,{value:_,onChange:c,onBlur:g}),o.name&&e.jsx("span",{style:{color:"red"},children:"The Name is required."})]}),name:"name"}),e.jsx(f,{control:n,rules:{required:!0},render:({field:{onChange:c,onBlur:g,value:_}})=>e.jsxs(p.Item,{label:"Price per month",children:[e.jsx(w,{value:_,onChange:c,onBlur:g,prefix:"¥",addonBefore:"+",addonAfter:"$",defaultValue:100}),o.price_per_month&&e.jsx("span",{style:{color:"red"},children:"The price per month is required."})]}),name:"price_per_month"}),e.jsx(f,{control:n,rules:{required:!0},render:({field:{onChange:c,onBlur:g,value:_}})=>e.jsxs(p.Item,{label:"floor area size",children:[e.jsx(w,{value:_,onChange:c,onBlur:g}),o.floor_area_size&&e.jsx("span",{style:{color:"red"},children:"The floor area size is required."})]}),name:"floor_area_size"}),e.jsx(f,{control:n,rules:{required:!0},render:({field:{onChange:c,onBlur:g,value:_}})=>e.jsxs(p.Item,{label:"number of rooms",children:[e.jsx(w,{value:_,onChange:c,onBlur:g}),o.floor_area_size&&e.jsx("span",{style:{color:"red"},children:"The number of rooms is required."})]}),name:"number_of_rooms"}),e.jsx(f,{control:n,rules:{required:!0},render:({field:{onChange:c,onBlur:g,value:_}})=>e.jsxs(p.Item,{label:"Description",children:[e.jsx(V,{rows:4,value:_,onChange:c,onBlur:g}),o.description&&e.jsx("span",{style:{color:"red"},children:"The Description is required."})]}),name:"description"})]}),e.jsx("div",{children:e.jsx(C,{type:"text",onClick:()=>{u(!0)},children:e.jsx(W,{size:20,color:"red"})})})]}),i,h?e.jsx(Te,{currentRowId:t,title:"Delete Apartment",onCancel:()=>{u(!1),r()},isModalOpen:h}):e.jsx(e.Fragment,{})]})}const De=y.memo(Le),$=()=>{const[r,s]=y.useState("CLIENT");return y.useEffect(()=>{const o=Ce();o&&s(o)},[]),{isAdmin:()=>r==="ADMIN",isClient:()=>r==="CLIENT",isRealtor:()=>r==="REALTOR"}},Me="https://res.cloudinary.com/homelike/image/upload/w_1900,c_fit,f_auto/homelike-05/uploads/4b4f6f4888bc12223a9e6b31320b9e0e2024d56001f32edf974e813baf3d12d1.jpeg?q=auto";function Oe({item:r}){const[s,t]=y.useState(!1),{isClient:n}=$(),{name:a,price_per_month:o,number_of_rooms:l,floor_area_size:i,status:h,id:u}=r;return e.jsxs("div",{style:{width:"280px",margin:"14px",height:"370px",backgroundColor:"white"},children:[e.jsx("div",{className:"apartment-img",style:{width:"100%",height:"50%",backgroundColor:"gray"},children:e.jsx("img",{width:"100%",height:"100%",src:Me})}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{children:a}),e.jsxs("div",{className:"mt-8",children:[e.jsxs("div",{className:"flex justify-between items-center",style:{width:"60%"},children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:i}),e.jsxs("span",{className:"unit ml-1",children:["ft",e.jsx("sup",{children:"2"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:l}),e.jsx("span",{className:"unit ml-1",children:"rooms"})]})]}),e.jsx(ce,{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:h?e.jsx("span",{className:"text-green-500",children:"Available"}):e.jsx("span",{className:"text-red-500",children:"Rented"})}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-bold",children:[" £",o]}),e.jsx("span",{className:"unit ml-1",children:"/month"})," "]}),e.jsx("div",{children:!n()&&e.jsx(C,{type:"text",onClick:()=>t(!0),children:e.jsx(G,{size:20})})})]})]})]}),s?e.jsx(De,{id:u,onCancel:()=>{t(!1)},isModalOpen:s}):e.jsx(e.Fragment,{})]})}const Pe=L({name:b().required(),description:b(),price_per_month:N().required(),floor_area_size:N().required(),number_of_rooms:N().required()});function ze({onCancel:r,isModalOpen:s}){const{control:t,handleSubmit:n,formState:{errors:a}}=q({defaultValues:{name:"",description:"",price_per_month:0,floor_area_size:0,number_of_rooms:0},resolver:R(Pe)}),{openNotification:o,contextHolder:l}=S(),i=T(),{mutate:h}=Ie({onSuccess(m){r(),i.invalidateQueries(["get-apartments"]),o("The apartment has been added successfully","success")},onError:()=>{o("Failed to add a new apartment","error")}}),u=m=>({name:m.name,description:m.description,price_per_month:parseFloat(m.price_per_month),floor_area_size:parseFloat(m.floor_area_size),number_of_rooms:parseInt(m.number_of_rooms),coordinates:JSON.stringify([130.342,32.3213])}),x=m=>{const d=u(m);Object.keys(d).length!==0&&h(d)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{title:"Add New Apartment",style:{height:500},open:s,onOk:n(x),onCancel:r,children:e.jsxs(p,{layout:"vertical",children:[e.jsx(f,{control:t,rules:{required:!0},render:({field:{onChange:m,onBlur:d,value:j}})=>e.jsxs(p.Item,{label:"Name",children:[e.jsx(v,{value:j,onChange:m,onBlur:d}),a.name&&e.jsx("span",{style:{color:"red"},children:"The Name is required."})]}),name:"name"}),e.jsx(f,{control:t,rules:{required:!0},render:({field:{onChange:m,onBlur:d,value:j}})=>e.jsxs(p.Item,{label:"Price per month",children:[e.jsx(w,{value:j,onChange:m,onBlur:d,prefix:"¥",addonBefore:"+",addonAfter:"$",defaultValue:100}),a.price_per_month&&e.jsx("span",{style:{color:"red"},children:"The price per month is required."})]}),name:"price_per_month"}),e.jsx(f,{control:t,rules:{required:!0},render:({field:{onChange:m,onBlur:d,value:j}})=>e.jsxs(p.Item,{label:"floor area size",children:[e.jsx(w,{value:j,onChange:m,onBlur:d}),a.floor_area_size&&e.jsx("span",{style:{color:"red"},children:"The floor area size is required."})]}),name:"floor_area_size"}),e.jsx(f,{control:t,rules:{required:!0},render:({field:{onChange:m,onBlur:d,value:j}})=>e.jsxs(p.Item,{label:"number of rooms",children:[e.jsx(w,{value:j,onChange:m,onBlur:d}),a.floor_area_size&&e.jsx("span",{style:{color:"red"},children:"The number of rooms is required."})]}),name:"number_of_rooms"}),e.jsx(f,{control:t,rules:{required:!0},render:({field:{onChange:m,onBlur:d,value:j}})=>e.jsxs(p.Item,{label:"Description",children:[e.jsx(V,{rows:4,value:j,onChange:m,onBlur:d}),a.description&&e.jsx("span",{style:{color:"red"},children:"The Description is required."})]}),name:"description"})]})}),l]})}const Ue=y.memo(ze);var $e={};const He=$e.REACT_APP_API_KEY||"";function Be(){return e.jsx(xe,{apiKey:He,children:e.jsx(je,{zoom:3,center:{lat:22.54992,lng:0},gestureHandling:"greedy",disableDefaultUI:!0})})}const Ke=y.memo(Be),M=({onClick:r,children:s})=>e.jsx(e.Fragment,{children:e.jsx(C,{style:{width:"100%"},onClick:r,children:s})});function Qe({onCancel:r,isModalOpen:s,getFilter:t}){const{control:n,handleSubmit:a,reset:o}=q({defaultValues:{price_per_month:0,floor_area_size:0,number_of_rooms:0}}),l=i=>{t(i),r()};return e.jsx(e.Fragment,{children:e.jsxs(F,{title:"Filter Apartments",style:{height:500},open:s,onOk:a(l),onCancel:r,children:[e.jsxs(p,{layout:"vertical",children:[e.jsx(f,{control:n,rules:{required:!0},render:({field:{onChange:i,onBlur:h,value:u}})=>e.jsx(p.Item,{label:"Price per month",children:e.jsx(w,{value:u,onChange:i,onBlur:h,prefix:"¥",addonBefore:"+",addonAfter:"$",defaultValue:100})}),name:"price_per_month"}),e.jsx(f,{control:n,rules:{required:!0},render:({field:{onChange:i,onBlur:h,value:u}})=>e.jsx(p.Item,{label:"floor area size",children:e.jsx(w,{value:u,onChange:i,onBlur:h})}),name:"floor_area_size"}),e.jsx(f,{control:n,rules:{required:!0},render:({field:{onChange:i,onBlur:h,value:u}})=>e.jsx(p.Item,{label:"number of rooms",children:e.jsx(w,{value:u,onChange:i,onBlur:h})}),name:"number_of_rooms"})]}),e.jsx("div",{children:e.jsx(M,{onClick:()=>{t({}),o()},children:"Reset Filter"})})]})})}function re({titleButton:r,onClick:s}){return e.jsx(e.Fragment,{children:e.jsx("div",{style:{backgroundColor:"white",textAlign:"right"},className:"p-4",children:e.jsx(C,{type:"primary",onClick:s,children:r})})})}function Ve(){const[r,s]=y.useState(!1),[t,n]=y.useState(!1),{isClient:a}=$(),[o,l]=y.useState({take:10}),{data:i,isSuccess:h,isLoading:u}=qe(o),x=m=>{l({...o,...m})};return e.jsxs(e.Fragment,{children:[a()?e.jsx(e.Fragment,{}):e.jsx(re,{titleButton:"Add new Apartment",onClick:()=>s(!0)}),e.jsxs("div",{className:"flex justify-between mt-4 mb-4 p-4",children:[e.jsxs("div",{style:{width:"71%"},children:[e.jsxs("div",{className:"mb-6 flex justify-between",children:[e.jsx("h2",{children:" Furnished Apartments for Rent"}),e.jsx(C,{type:"text",onClick:()=>{n(!0)},children:e.jsx(pe,{size:25})})]}),e.jsx("div",{className:"flex flex-wrap",children:h&&!u?i==null?void 0:i.data.map(m=>e.jsx(Oe,{item:m})):e.jsx(e.Fragment,{children:"No Apartments Found"})})]}),e.jsx("div",{style:{width:"25%"},children:e.jsx(Ke,{})})]}),r&&e.jsx(Ue,{onCancel:()=>{s(!1)},isModalOpen:r}),e.jsx(Qe,{getFilter:x,isModalOpen:t,onCancel:()=>{n(!1)}})]})}const I=()=>{const r=Y();return{handleOnLogin:a=>{const{access_token:o,username:l,role:i}=a;o&&(Ne(o),be(o),we(l,i),r("/",{replace:!0}))},handleOnLogout:()=>{ve(),r("/login",{replace:!0})},isAuthenticated:()=>!!X()}},Je=({onSuccess:r,onError:s})=>{const{mutate:t,isError:n,isLoading:a,isSuccess:o,data:l}=A({mutationFn:i=>P("auth/register",i),onSuccess:r,onError:s});return{mutate:t,isError:n,isLoading:a,isSuccess:o,data:l}},We=({onSuccess:r,onError:s})=>{const{mutate:t,isError:n,isLoading:a,isSuccess:o,data:l}=A({mutationFn:i=>P("auth/login",i),onSuccess:r,onError:s});return{mutate:t,isError:n,isLoading:a,isSuccess:o,data:l}},Ge=L({email:b().required(),password:b()}).required();function Ye(){const{handleOnLogin:r}=I(),{contextHolder:s,openNotification:t}=S(),{mutate:n}=We({onSuccess:u=>{u.data.access_token&&(r(u.data),t("Successfully logged in ","success"))},onError(u,x,m){t(`unable to logged in, ${u.message}`,"error")}}),{control:a,handleSubmit:o,formState:{errors:l}}=q({defaultValues:{email:"",password:""},resolver:R(Ge)}),i=u=>({email:u.email,password:u.password}),h=u=>{const x=i(u);n(x)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex justify-center items-center",style:{backgroundColor:"white",height:"70vh"},children:[s,e.jsxs("div",{style:{width:"30%"},children:[e.jsx("h1",{children:"Sign Up"}),e.jsxs(p,{children:[e.jsx(f,{control:a,rules:{required:!0},render:({field:{onChange:u,onBlur:x,value:m}})=>e.jsxs(p.Item,{label:"",className:"mt-6 mb-6",children:[e.jsx(v,{value:m,placeholder:"E-email",onChange:u,onBlur:x}),l.email&&e.jsx("span",{style:{color:"red"},children:"The Email is required."})]}),name:"email"}),e.jsx(f,{control:a,rules:{required:!0},render:({field:{onChange:u,onBlur:x,value:m}})=>e.jsxs(p.Item,{label:"",className:"mt-6 mb-6",children:[e.jsx(v.Password,{value:m,placeholder:"password",onChange:u,onBlur:x}),l.password&&e.jsx("span",{style:{color:"red"},children:"The Password is required."})]}),name:"password"}),e.jsxs("div",{children:[e.jsx(M,{onClick:o(h),children:"Sign Up"}),e.jsxs("div",{className:"p-4 pl-0",children:[e.jsxs("p",{style:{display:"inline-block"},className:"mr-2",children:[" ","Don't have an account ?"]}),e.jsx(k,{to:"/register",children:"Create an account"})]})]})]})]})]})})}const Xe=y.memo(Ye);var E=(r=>(r.ADMIN="ADMIN",r.CLIENT="CLIENT",r.REALTOR="REALTOR",r))(E||{});const Ze=L({email:b().required(),password:b().required(),username:b().required()}).required();function er(){const{handleOnLogin:r}=I(),[s,t]=y.useState(!1),{contextHolder:n,openNotification:a}=S(),{mutate:o}=Je({onSuccess:d=>{d.data.access_token&&(r(d.data),a("Successfully created a new account","success"))},onError(d,j,c){a(`unable to create a new account, ${d.message}`,"error")}}),{control:l,handleSubmit:i,formState:{errors:h}}=q({defaultValues:{email:"",password:"",username:""},resolver:R(Ze)}),u=d=>({email:d.email,username:d.username,password:d.password,role:s?E.REALTOR:E.CLIENT}),x=d=>{const j=u(d);o(j)},m=d=>{t(d.target.checked)};return e.jsxs("div",{className:"flex justify-center items-center",style:{backgroundColor:"white",height:"70vh"},children:[e.jsxs("div",{style:{width:"30%"},children:[e.jsx("h1",{children:"Create new account"}),e.jsxs(p,{children:[e.jsx(f,{control:l,rules:{required:!0},render:({field:{onChange:d,onBlur:j,value:c}})=>e.jsxs(p.Item,{label:"",className:"mt-6 mb-6",children:[e.jsx(v,{value:c,placeholder:"Username",onChange:d,onBlur:j}),h.username&&e.jsx("span",{style:{color:"red"},children:"The username is required."})]}),name:"username"}),e.jsx("div",{className:"mt-6 mb-6",children:e.jsx(J,{value:s,onChange:m,children:"as Realtor"})}),e.jsx(f,{control:l,rules:{required:!0},render:({field:{onChange:d,onBlur:j,value:c}})=>e.jsxs(p.Item,{label:"",className:"mt-6 mb-6",children:[e.jsx(v,{value:c,placeholder:"E-email",onChange:d,onBlur:j}),h.email&&e.jsx("span",{style:{color:"red"},children:"The Email is required."})]}),name:"email"}),e.jsx(f,{control:l,rules:{required:!0},render:({field:{onChange:d,onBlur:j,value:c}})=>e.jsxs(p.Item,{label:"",className:"mt-6 mb-6",children:[e.jsx(v.Password,{value:c,placeholder:"password",onChange:d,onBlur:j}),h.password&&e.jsx("span",{style:{color:"red"},children:"The Password is required."})]}),name:"password"}),e.jsxs("div",{children:[e.jsx(M,{onClick:i(x),children:"Sign In"}),e.jsxs("div",{className:"p-4 pl-0",children:[e.jsx("p",{style:{display:"inline-block"},className:"mr-2",children:"Do you have an account already ?"}),e.jsx(k,{to:"/login",children:"Sign up"})]})]})]})]}),n]})}const rr="_mainHeader_1f18g_2",sr={mainHeader:rr};function tr(){const{handleOnLogout:r}=I(),s=[{key:"1",label:e.jsx(M,{onClick:r,children:"Logout"})}];return e.jsx(e.Fragment,{children:e.jsx(de,{menu:{items:s},children:e.jsxs("div",{children:[e.jsx(ue,{shape:"square",size:"large",icon:e.jsx(ge,{})}),e.jsx("span",{className:"font-bold pl-4",children:sessionStorage.getItem("username")?sessionStorage.getItem("username"):"User"})]})})})}const nr=y.memo(tr);function or(){const[r,s]=y.useState("home"),{isAuthenticated:t}=I(),{isAdmin:n}=$(),a=Y(),o=i=>{s(i.key)},l=()=>{a("/register")};return e.jsxs("div",{className:sr.mainHeader,children:[e.jsx("div",{style:{backgroundColor:"black",fontFamily:"fantasy"},children:e.jsx("h1",{style:{color:"white",fontWeight:"bold"},children:"Rental UK"})}),e.jsx("div",{className:"flex justify-between",style:{width:"40%"},children:e.jsx(O,{onClick:o,selectedKeys:[r],mode:"horizontal",inlineCollapsed:!1,children:t()?e.jsxs(e.Fragment,{children:[e.jsx(O.Item,{children:e.jsx(k,{to:"/",children:"Home"})},"home"),n()&&e.jsx(O.Item,{children:e.jsx(k,{to:"/users",children:"Users"})},"users"),e.jsx(O.Item,{children:e.jsx(k,{to:"/apartments",children:"Apartments"})},"apartments")]}):e.jsx(e.Fragment,{})})}),e.jsx("div",{style:{width:"200px flex justify-between"},children:t()?e.jsx(e.Fragment,{children:e.jsx(nr,{})}):e.jsx(M,{onClick:l,children:"Sign in"})})]})}function ar(){return e.jsxs(e.Fragment,{children:[e.jsx(or,{}),e.jsx(fe,{})]})}const ir=()=>{const{data:r,isSuccess:s,isLoading:t}=K({queryKey:["get-users"],queryFn:()=>Z("users/list")});return{data:r,isSuccess:s,isLoading:t}},lr=({onSuccess:r,onError:s})=>{const{mutate:t,isError:n,isLoading:a,isSuccess:o,data:l}=A({mutationFn:i=>ee(`users/${i}`),onSuccess:r,onError:s});return{mutate:t,isError:n,isLoading:a,isSuccess:o,data:l}},cr=({onSuccess:r,onError:s})=>{const{mutate:t,isError:n,isLoading:a,isSuccess:o,data:l}=A({mutationFn:i=>P("users/new",i),onSuccess:r,onError:s});return{mutate:t,isError:n,isLoading:a,isSuccess:o,data:l}};function dr({onCancel:r,isModalOpen:s,title:t,currentRowId:n}){const a=T(),{openNotification:o,contextHolder:l}=S(),{mutate:i}=lr({onSuccess:()=>{o("Deleted user successfully","success"),r(),a.invalidateQueries("get-users")},onError:()=>{o("Failed to deleted the user!","error")}}),h=()=>{i(n)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{title:t,style:{height:300},open:s,onOk:h,onCancel:r,children:e.jsx(Q,{type:"error",description:"Are you sure to delete the user?"})}),l]})}const ur=L({email:b().required(),password:b().required(),username:b().required()}).required();function mr({onCancel:r,isModalOpen:s}){const{openNotification:t,contextHolder:n}=S(),a=T(),{mutate:o}=cr({onSuccess(){t("The user has been added successfully","success"),a.invalidateQueries(["get-users"]),r()},onError:()=>{t("Failed to user a new apartment","error")}}),[l,i]=y.useState(!1),{control:h,handleSubmit:u,formState:{errors:x}}=q({defaultValues:{email:"",password:"",username:""},resolver:R(ur)}),m=c=>({email:c.email,username:c.username,password:c.password,role:l?E.REALTOR:E.CLIENT}),d=c=>{const g=m(c);o(g)},j=c=>{i(c.target.checked)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{title:"Add New User",style:{height:500},open:s,onOk:u(d),onCancel:r,children:e.jsxs(p,{children:[e.jsx(f,{control:h,rules:{required:!0},render:({field:{onChange:c,onBlur:g,value:_}})=>e.jsxs(p.Item,{label:"",className:"mt-6 mb-6",children:[e.jsx(v,{value:_,placeholder:"Username",onChange:c,onBlur:g}),x.username&&e.jsx("span",{style:{color:"red"},children:"The username is required."})]}),name:"username"}),e.jsx("div",{className:"mt-6 mb-6",children:e.jsx(J,{value:l,onChange:j,children:"as Realtor"})}),e.jsx(f,{control:h,rules:{required:!0},render:({field:{onChange:c,onBlur:g,value:_}})=>e.jsxs(p.Item,{label:"",className:"mt-6 mb-6",children:[e.jsx(v,{value:_,placeholder:"E-email",onChange:c,onBlur:g}),x.email&&e.jsx("span",{style:{color:"red"},children:"The Email is required."})]}),name:"email"}),e.jsx(f,{control:h,rules:{required:!0},render:({field:{onChange:c,onBlur:g,value:_}})=>e.jsxs(p.Item,{label:"",className:"mt-6 mb-6",children:[e.jsx(v.Password,{value:_,placeholder:"password",onChange:c,onBlur:g}),x.password&&e.jsx("span",{style:{color:"red"},children:"The Password is required."})]}),name:"password"})]})}),n]})}const hr=y.memo(mr);function pr(){const{data:r,isLoading:s,isSuccess:t}=ir(),[n,a]=y.useState(!1),[o,l]=y.useState(""),[i,h]=y.useState(!1),u=[{title:"Username",dataIndex:"username",key:"username"},{title:"Email",dataIndex:"email",key:"email"},{title:"Role",render:x=>e.jsx(e.Fragment,{children:e.jsx("span",{style:{backgroundColor:"green",color:"white",borderRadius:"20px",display:"inline-block",padding:"5px 10px"},children:x.role})})},{title:"Actions",render:x=>e.jsxs(e.Fragment,{children:[e.jsx(C,{type:"text",children:e.jsx(G,{size:20})}),e.jsx(C,{type:"text",onClick:()=>{a(!0),l(x.id)},children:e.jsx(W,{size:20,color:"red"})})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(re,{titleButton:"Add new user",onClick:()=>h(!0)}),e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"m-4",children:"Users"}),e.jsx("div",{children:e.jsx(me,{dataSource:t?r==null?void 0:r.data:[],loading:s,columns:u})}),e.jsx(dr,{currentRowId:o,title:"Delete User",onCancel:()=>{a(!1)},isModalOpen:n})]}),i&&e.jsx(hr,{onCancel:()=>{h(!1)},isModalOpen:i})]})}const H=({children:r})=>{const{isAuthenticated:s}=I();return s()?e.jsx(e.Fragment,{children:r}):e.jsx(z,{to:"/login"})},B=({children:r})=>{const{isAuthenticated:s}=I();return s()?e.jsx(z,{to:"/"}):e.jsx(e.Fragment,{children:r})},xr=ae([{path:"/",element:e.jsx(z,{to:"/apartments"})},{path:"/",element:e.jsx(ar,{}),children:[{path:"apartments",element:e.jsx(H,{children:e.jsx(Ve,{})})},{path:"users",element:e.jsx(H,{children:e.jsx(pr,{})})},{path:"login",element:e.jsx(B,{children:e.jsx(Xe,{})})},{path:"register",element:e.jsx(B,{children:e.jsx(er,{})})}]}]);function jr(){if("serviceWorker"in navigator){const r=new ye("/sw.js");r.addEventListener("activated",s=>{s.isUpdate||console.log("Service worker activated for the first time!");const t=[location.href,...performance.getEntriesByType("resource").map(n=>n.name)];r.messageSW({type:"CACHE_URLS",payload:{urlsToCache:t}})}),r.addEventListener("message",s=>{if(s.data.type==="CACHE_UPDATED"){const{updatedURL:t}=s.data.payload;console.log(`A newer version of ${t} is available!`)}}),r.register()}else console.error("Service workers are not supported.");window.addEventListener("beforeinstallprompt",r=>{r.preventDefault(),window.deferredPrompt=r,console.log("Registerd event"),window.localStorage.setItem("pwainstalled","false")}),window.addEventListener("appinstalled",r=>{console.log("INSTALL: Success"),window.localStorage.setItem("pwainstalled","true")})}function fr(){y.useEffect(()=>{jr()},[]);const r=new ne;return e.jsxs(oe,{client:r,children:[e.jsx(ie,{router:xr}),";"]})}const gr=te.createRoot(document.getElementById("root"));gr.render(e.jsx(se.StrictMode,{children:e.jsx(fr,{})}));
